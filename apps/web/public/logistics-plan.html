<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>C&C Logistics Module - Implementation Plan</title>
  <style>
    :root {
      --bg-primary: #0a0a0a;
      --bg-secondary: #141414;
      --bg-tertiary: #1a1a1a;
      --border-color: #2a2a2a;
      --text-primary: #f5f5f5;
      --text-secondary: #a0a0a0;
      --text-muted: #666;
      --accent-blue: #3b82f6;
      --accent-green: #22c55e;
      --accent-yellow: #eab308;
      --accent-red: #ef4444;
      --accent-purple: #a855f7;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.6;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 2rem;
    }

    header {
      text-align: center;
      padding: 3rem 0;
      border-bottom: 1px solid var(--border-color);
      margin-bottom: 3rem;
    }

    header h1 {
      font-size: 2.5rem;
      margin-bottom: 0.5rem;
      background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    header p {
      color: var(--text-secondary);
      font-size: 1.1rem;
    }

    .toc {
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      padding: 2rem;
      margin-bottom: 3rem;
    }

    .toc h2 {
      font-size: 1.3rem;
      margin-bottom: 1rem;
      color: var(--accent-blue);
    }

    .toc-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 0.5rem;
    }

    .toc a {
      color: var(--text-secondary);
      text-decoration: none;
      padding: 0.3rem 0;
      transition: color 0.2s;
    }

    .toc a:hover {
      color: var(--accent-blue);
    }

    section {
      margin-bottom: 4rem;
    }

    h2 {
      font-size: 1.8rem;
      margin-bottom: 1.5rem;
      padding-bottom: 0.5rem;
      border-bottom: 2px solid var(--accent-blue);
    }

    h3 {
      font-size: 1.3rem;
      margin: 2rem 0 1rem;
      color: var(--accent-purple);
    }

    h4 {
      font-size: 1.1rem;
      margin: 1.5rem 0 0.75rem;
      color: var(--text-secondary);
    }

    p {
      margin-bottom: 1rem;
      color: var(--text-secondary);
    }

    ul, ol {
      margin-bottom: 1rem;
      padding-left: 2rem;
      color: var(--text-secondary);
    }

    li {
      margin-bottom: 0.5rem;
    }

    .priority-table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 2rem;
    }

    .priority-table th,
    .priority-table td {
      padding: 1rem;
      text-align: left;
      border: 1px solid var(--border-color);
    }

    .priority-table th {
      background: var(--bg-tertiary);
      color: var(--accent-blue);
    }

    .priority-table td:first-child {
      font-weight: bold;
      color: var(--accent-yellow);
    }

    .code-block {
      background: var(--bg-tertiary);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      padding: 1.5rem;
      margin: 1rem 0;
      overflow-x: auto;
      font-family: 'Monaco', 'Menlo', monospace;
      font-size: 0.9rem;
      white-space: pre;
      color: var(--text-secondary);
    }

    .wireframe {
      background: var(--bg-tertiary);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      padding: 1.5rem;
      margin: 1rem 0;
      overflow-x: auto;
      font-family: 'Monaco', 'Menlo', monospace;
      font-size: 0.75rem;
      white-space: pre;
      color: var(--accent-green);
    }

    .card {
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
    }

    .card h3 {
      margin-top: 0;
      color: var(--accent-blue);
    }

    .user-table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 2rem;
    }

    .user-table th,
    .user-table td {
      padding: 1rem;
      text-align: left;
      border: 1px solid var(--border-color);
    }

    .user-table th {
      background: var(--bg-tertiary);
      color: var(--accent-purple);
    }

    .schema-table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 2rem;
      font-size: 0.9rem;
    }

    .schema-table th,
    .schema-table td {
      padding: 0.75rem;
      text-align: left;
      border: 1px solid var(--border-color);
    }

    .schema-table th {
      background: var(--bg-tertiary);
      color: var(--accent-green);
    }

    .schema-table code {
      background: var(--bg-primary);
      padding: 0.2rem 0.4rem;
      border-radius: 4px;
      font-size: 0.85rem;
    }

    .phase-card {
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      padding: 2rem;
      margin-bottom: 2rem;
    }

    .phase-card h3 {
      margin-top: 0;
      color: var(--accent-yellow);
      font-size: 1.4rem;
    }

    .phase-card h4 {
      color: var(--accent-blue);
      margin-top: 1.5rem;
    }

    .task-list {
      list-style: none;
      margin: 1rem 0;
      padding-left: 0;
    }

    .task-list li {
      padding: 0.5rem 0;
      padding-left: 2rem;
      position: relative;
      color: var(--text-secondary);
    }

    .task-list li::before {
      content: '[ ]';
      position: absolute;
      left: 0;
      color: var(--text-muted);
      font-family: monospace;
    }

    .highlight-box {
      background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(168, 85, 247, 0.1));
      border: 1px solid var(--accent-blue);
      border-radius: 8px;
      padding: 1.5rem;
      margin: 1.5rem 0;
    }

    .highlight-box strong {
      color: var(--accent-blue);
    }

    .warning-box {
      background: rgba(234, 179, 8, 0.1);
      border: 1px solid var(--accent-yellow);
      border-radius: 8px;
      padding: 1.5rem;
      margin: 1.5rem 0;
    }

    .warning-box strong {
      color: var(--accent-yellow);
    }

    .pre-work-card {
      background: linear-gradient(135deg, rgba(239, 68, 68, 0.1), rgba(234, 179, 8, 0.1));
      border: 2px solid var(--accent-red);
      border-radius: 12px;
      padding: 2rem;
      margin-bottom: 2rem;
    }

    .pre-work-card h3 {
      margin-top: 0;
      color: var(--accent-red);
      font-size: 1.4rem;
    }

    .nav-redesign {
      background: var(--bg-tertiary);
      border: 2px solid var(--accent-purple);
      border-radius: 8px;
      padding: 1.5rem;
      margin: 1rem 0;
      font-family: 'Monaco', 'Menlo', monospace;
      font-size: 0.8rem;
      white-space: pre;
      color: var(--accent-purple);
    }

    .reference-table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 2rem;
      font-size: 0.85rem;
    }

    .reference-table th,
    .reference-table td {
      padding: 0.75rem;
      text-align: left;
      border: 1px solid var(--border-color);
    }

    .reference-table th {
      background: var(--bg-tertiary);
      color: var(--accent-blue);
    }

    .reference-table code {
      background: var(--bg-primary);
      padding: 0.2rem 0.4rem;
      border-radius: 4px;
      color: var(--accent-green);
    }

    footer {
      text-align: center;
      padding: 2rem;
      border-top: 1px solid var(--border-color);
      color: var(--text-muted);
      margin-top: 4rem;
    }

    @media (max-width: 768px) {
      .container {
        padding: 1rem;
      }

      header h1 {
        font-size: 1.8rem;
      }

      .wireframe, .code-block {
        font-size: 0.65rem;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>C&C Logistics Module</h1>
      <p>Comprehensive implementation plan for document tracking, shipment management, and landed cost calculation</p>
      <p style="margin-top: 1rem; color: var(--accent-yellow);">Main warehouse: RAK Port, UAE</p>
    </header>

    <nav class="toc">
      <h2>Table of Contents</h2>
      <div class="toc-grid">
        <a href="#priorities">Core Priorities</a>
        <a href="#how-we-achieve">How We Achieve Each Priority</a>
        <a href="#users">Users</a>
        <a href="#features">Features</a>
        <a href="#database">Database Schema</a>
        <a href="#workflows">Workflows</a>
        <a href="#wireframes">Wireframes</a>
        <a href="#integrations">Integrations</a>
        <a href="#pre-work">Pre-Work: Fix Local Inventory</a>
        <a href="#phases">Implementation Phases</a>
        <a href="#admin-tools">Admin Tools</a>
        <a href="#files">Key Files to Create</a>
        <a href="#verification">Verification Checklist</a>
      </div>
    </nav>

    <section id="priorities">
      <h2>Core Priorities</h2>
      <table class="priority-table">
        <thead>
          <tr>
            <th>Priority</th>
            <th>Goal</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>1. Document Tracking</td>
            <td>Centralized storage, easy search, never lose a document</td>
          </tr>
          <tr>
            <td>2. Scalability</td>
            <td>Structured processes that work at 10x volume</td>
          </tr>
          <tr>
            <td>3. Accuracy</td>
            <td>Correct workflows, validated documents, no errors</td>
          </tr>
          <tr>
            <td>4. Traceability</td>
            <td>Full audit trail - who did what, when, why</td>
          </tr>
          <tr>
            <td>5. Compliance</td>
            <td>Expiry alerts, required doc checklists, regulatory adherence</td>
          </tr>
          <tr>
            <td>6. Quotations</td>
            <td>Accurate quotes with proper review/approval process</td>
          </tr>
        </tbody>
      </table>
    </section>

    <section id="how-we-achieve">
      <h2>How We Achieve Each Priority</h2>

      <div class="card">
        <h3>1. Document Tracking</h3>
        <p><strong>Problem:</strong> Documents scattered in emails, drives, lost</p>
        <div class="code-block">Solution:
├── Centralized storage (Vercel Blob)
├── Linked to shipment (never orphaned)
├── Typed & tagged (BOL, invoice, permit, etc.)
├── Searchable by type, date, shipment, client
├── Version history (re-upload doesn't delete old)
└── AI extraction (auto-extract key fields)</div>
      </div>

      <div class="card">
        <h3>2. Scalability</h3>
        <p><strong>Problem:</strong> Manual processes break at volume</p>
        <div class="code-block">Solution:
├── Structured data (not spreadsheets)
├── Status pipelines (clear next steps)
├── Batch operations (process many at once)
├── API integrations (auto-sync with carriers)
├── Templates (reuse common configurations)
└── Dashboard views (see everything at a glance)</div>
      </div>

      <div class="card">
        <h3>3. Accuracy</h3>
        <p><strong>Problem:</strong> Errors in documents, wrong data entry</p>
        <div class="code-block">Solution:
├── Required fields (can't skip important data)
├── Document checklists (required docs per shipment type)
├── Validation rules (HS codes, dates, formats)
├── Status blocks (can't advance without docs)
├── Admin verification (sign-off on documents)
└── Calculated fields (auto-compute totals, weights)</div>
      </div>

      <div class="card">
        <h3>4. Traceability</h3>
        <p><strong>Problem:</strong> "Who changed this? When? Why?"</p>
        <div class="code-block">Solution:
├── Activity log per shipment
├── Document upload history (who, when)
├── Status change history (who, when, from/to)
├── Edit history (what changed)
├── User attribution (every action tracked)
└── Timestamps on everything</div>
      </div>

      <div class="card">
        <h3>5. Compliance</h3>
        <p><strong>Problem:</strong> Licenses expire, docs missing at customs</p>
        <div class="code-block">Solution:
├── Expiry tracking (90/60/30 day alerts)
├── Required document checklists per shipment type
├── Market-specific requirements (UAE vs Saudi vs Qatar)
├── Renewal status tracking
├── Compliance dashboard (see all risks at once)
└── Audit-ready export (all docs for a shipment)</div>
      </div>

      <div class="card">
        <h3>6. Quotations</h3>
        <p><strong>Problem:</strong> Quotes inaccurate, no review process</p>
        <div class="code-block">Solution:
├── Rate cards (predefined pricing by route)
├── Carrier API rates (live Hillebrand pricing)
├── Cost breakdown (freight, handling, margin visible)
├── Quote review status (draft → review → sent)
├── Approval workflow (admin approves before send)
├── Quote history (track win/loss, revisions)
└── Convert to shipment (accepted quote → shipment)</div>
      </div>

      <div class="card">
        <h3>7. Cost Analysis & Arbitrage</h3>
        <p><strong>Problem:</strong> Don't know true cost per bottle, miss arbitrage opportunities</p>
        <div class="highlight-box">
          <strong>LANDED COST = ALL costs to get product into warehouse</strong>
        </div>
        <div class="code-block">EXAMPLE CALCULATION (per shipment):
────────────────────────────────────
Product Cost (ex-cellar):    $5,760  (480 bottles x $12)
Freight (origin to UAE):     $2,400
Insurance:                     $120
Origin handling:               $150
Destination handling:          $200
Customs clearance:             $180
Government fees:               $150
Delivery to warehouse:         $100
────────────────────────────────────
TOTAL LANDED COST:           $9,060

/ Total Bottles:               480
────────────────────────────────────
= LANDED COST PER BOTTLE:    $18.88

This is the TRUE cost to have 1 bottle sitting in RAK Port warehouse.</div>

        <div class="code-block">ALLOCATION METHOD (for multi-product shipments):
├── By bottle count (simple split) - default
├── By weight (kg per item / total kg)
├── By value (item value / total value)
└── Admin selects method per shipment

Solution:
├── Auto-calculate landed cost per bottle
├── Shows TRUE cost in warehouse
├── Compare to target selling price
├── Show margin per bottle and %
├── Flag low/negative margins
│
├── Arbitrage tracking
│   ├── Compare landed cost vs market prices
│   ├── Compare across markets (UAE vs Qatar vs Saudi)
│   ├── Flag high-margin opportunities
│   └── Historical price trends
│
└── Reports
    ├── Full cost breakdown by shipment
    ├── Landed cost per bottle by product
    ├── Margin analysis
    └── Arbitrage opportunities</div>
      </div>

      <div class="card">
        <h3>8. Customs Deposits (FZ to FZ Transfers)</h3>
        <p><strong>Problem:</strong> Cash tied up in customs deposits, manual tracking, delayed reclaims</p>
        <div class="code-block">WHAT ARE CUSTOMS DEPOSITS?
├── Required for bonded road transfers within UAE
├── FZ to FZ (Free Zone to Free Zone) movements
├── Example: RAK Port → JAFZA or RAK → DWC
├── Cash held by customs until paperwork complete
└── Must stamp documents to reclaim deposit

PROCESS:
1. DEPOSIT PAID
   ├── Pay deposit to customs
   ├── Amount based on cargo value
   └── Status: pending

2. TRANSFER COMPLETE
   ├── Goods arrive at destination FZ
   ├── Receive stamped documents
   └── Status: transferred

3. PAPERWORK SUBMITTED
   ├── Submit stamped docs to customs
   └── Status: submitted

4. DEPOSIT RECLAIMED
   ├── Customs returns deposit
   ├── Record date received
   └── Status: reclaimed

TRACKING:
├── Total deposits outstanding (cash flow)
├── Age of deposits (flag overdue)
├── Reclaim success rate
├── Average days to reclaim
└── Blocked shipments (deposit issues)</div>
      </div>
    </section>

    <section id="users">
      <h2>Users</h2>
      <table class="user-table">
        <thead>
          <tr>
            <th>User</th>
            <th>What They Do</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>Admin</strong></td>
            <td>Manage all shipments, quotes, documents, invoicing</td>
          </tr>
          <tr>
            <td><strong>Partner</strong></td>
            <td>View their inbound shipments, upload documents</td>
          </tr>
          <tr>
            <td><strong>Client</strong></td>
            <td>View their outbound shipments, download documents</td>
          </tr>
        </tbody>
      </table>
    </section>

    <section id="features">
      <h2>Features</h2>

      <div class="card">
        <h3>1. Shipments</h3>
        <ul>
          <li>Create inbound/outbound/re-export shipments</li>
          <li>Track via carrier APIs (Hillebrand, Hapag-Lloyd)</li>
          <li>Status: draft → booked → in transit → customs → delivered</li>
        </ul>
      </div>

      <div class="card">
        <h3>2. Documents</h3>
        <ul>
          <li>Upload BOL, AWB, invoices, certificates, permits</li>
          <li>Expiry alerts at 90/60/30 days</li>
          <li>AI extraction of key fields</li>
        </ul>
      </div>

      <div class="card">
        <h3>3. Quotes</h3>
        <ul>
          <li>Generate logistics quotes for clients</li>
          <li>Pull rates from Hillebrand API or manual entry</li>
          <li>Convert accepted quotes to shipments</li>
        </ul>
      </div>

      <div class="card">
        <h3>4. Compliance</h3>
        <ul>
          <li>Track license expiry by client/product/market</li>
          <li>Renewal status tracking</li>
          <li>Document checklists per shipment</li>
        </ul>
      </div>

      <div class="card">
        <h3>5. Payments</h3>
        <ul>
          <li>Track freight costs (what C&C pays)</li>
          <li>Track government charges/fees (not duty - just admin fees)</li>
          <li>Invoice clients, sync to Zoho Books</li>
        </ul>
      </div>

      <div class="card">
        <h3>6. Customs Deposits (FZ to FZ Transfers)</h3>
        <ul>
          <li>Track cash deposits held for bonded road transfers</li>
          <li>FZ to FZ (Free Zone) transfers within UAE mainland</li>
          <li>Paperwork stamping process to reclaim deposit</li>
          <li>Deposit status: pending → stamped → reclaimed</li>
          <li>Cash flow visibility (deposits outstanding)</li>
        </ul>
      </div>
    </section>

    <section id="database">
      <h2>Database Schema</h2>

      <h3>Enums</h3>
      <div class="code-block">// Shipment direction
logisticsShipmentType = ['inbound', 'outbound', 're_export']

// Transport mode
logisticsTransportMode = ['sea_fcl', 'sea_lcl', 'air', 'road']

// Shipment status pipeline
logisticsShipmentStatus = [
  'draft',              // Initial creation
  'booked',             // Carrier booking confirmed
  'picked_up',          // Cargo collected
  'in_transit',         // On the way
  'arrived_port',       // Arrived at destination port
  'customs_clearance',  // Going through customs
  'cleared',            // Customs cleared
  'at_warehouse',       // At RAK Port warehouse
  'dispatched',         // Sent out for delivery
  'delivered',          // Final delivery
  'cancelled'           // Cancelled
]

// Document types
logisticsDocumentType = [
  'bill_of_lading', 'airway_bill', 'commercial_invoice', 'packing_list',
  'certificate_of_origin', 'customs_declaration', 'import_permit',
  'export_permit', 'delivery_note', 'health_certificate', 'other'
]

// Quote status
logisticsQuoteStatus = ['draft', 'sent', 'accepted', 'rejected', 'expired', 'converted']</div>

      <h3>Tables</h3>

      <h4>logistics_shipments</h4>
      <table class="schema-table">
        <thead>
          <tr><th>Column</th><th>Type</th><th>Description</th></tr>
        </thead>
        <tbody>
          <tr><td><code>id</code></td><td>uuid</td><td>PK</td></tr>
          <tr><td><code>shipmentNumber</code></td><td>text</td><td>"SHP-2026-0001"</td></tr>
          <tr><td><code>type</code></td><td>enum</td><td>inbound, outbound, re_export</td></tr>
          <tr><td><code>transportMode</code></td><td>enum</td><td>sea_fcl, sea_lcl, air, road</td></tr>
          <tr><td><code>status</code></td><td>enum</td><td>Current pipeline status</td></tr>
          <tr><td><code>partnerId</code></td><td>uuid FK</td><td>Wine partner (inbound)</td></tr>
          <tr><td><code>clientContactId</code></td><td>uuid FK</td><td>Client (outbound)</td></tr>
          <tr><td><code>originCountry</code></td><td>text</td><td>e.g., "France"</td></tr>
          <tr><td><code>originCity</code></td><td>text</td><td>e.g., "Bordeaux"</td></tr>
          <tr><td><code>destinationCountry</code></td><td>text</td><td>e.g., "UAE"</td></tr>
          <tr><td><code>destinationCity</code></td><td>text</td><td>e.g., "Dubai"</td></tr>
          <tr><td><code>carrierId</code></td><td>uuid FK</td><td>Shipping carrier</td></tr>
          <tr><td><code>carrierBookingRef</code></td><td>text</td><td>Carrier's reference</td></tr>
          <tr><td><code>containerNumber</code></td><td>text</td><td>For sea freight</td></tr>
          <tr><td><code>blNumber</code></td><td>text</td><td>Bill of Lading #</td></tr>
          <tr><td><code>awbNumber</code></td><td>text</td><td>Airway Bill #</td></tr>
          <tr><td><code>etd</code></td><td>timestamp</td><td>Estimated departure</td></tr>
          <tr><td><code>atd</code></td><td>timestamp</td><td>Actual departure</td></tr>
          <tr><td><code>eta</code></td><td>timestamp</td><td>Estimated arrival</td></tr>
          <tr><td><code>ata</code></td><td>timestamp</td><td>Actual arrival</td></tr>
          <tr><td><code>deliveredAt</code></td><td>timestamp</td><td>Final delivery</td></tr>
          <tr><td><code>totalCases</code></td><td>integer</td><td>Number of cases</td></tr>
          <tr><td><code>totalWeightKg</code></td><td>decimal</td><td>Total weight</td></tr>
          <tr><td><code>freightCostUsd</code></td><td>decimal</td><td>C&C cost</td></tr>
          <tr><td><code>notes</code></td><td>text</td><td>Internal notes</td></tr>
          <tr><td><code>createdAt</code></td><td>timestamp</td><td></td></tr>
          <tr><td><code>updatedAt</code></td><td>timestamp</td><td></td></tr>
        </tbody>
      </table>

      <h4>logistics_shipment_items</h4>
      <table class="schema-table">
        <thead>
          <tr><th>Column</th><th>Type</th><th>Description</th></tr>
        </thead>
        <tbody>
          <tr><td><code>id</code></td><td>uuid</td><td>PK</td></tr>
          <tr><td><code>shipmentId</code></td><td>uuid FK</td><td>Parent shipment</td></tr>
          <tr><td><code>productId</code></td><td>uuid FK</td><td>Product (optional)</td></tr>
          <tr><td><code>productName</code></td><td>text</td><td>Fallback name</td></tr>
          <tr><td><code>producer</code></td><td>text</td><td>Wine producer</td></tr>
          <tr><td><code>vintage</code></td><td>integer</td><td>Year</td></tr>
          <tr><td><code>hsCode</code></td><td>text</td><td>"2204.21"</td></tr>
          <tr><td><code>countryOfOrigin</code></td><td>text</td><td>COO</td></tr>
          <tr><td><code>cases</code></td><td>integer</td><td>Number of cases</td></tr>
          <tr><td><code>bottlesPerCase</code></td><td>integer</td><td>e.g., 12</td></tr>
          <tr><td><code>bottleSizeMl</code></td><td>integer</td><td>e.g., 750</td></tr>
          <tr><td><code>grossWeightKg</code></td><td>decimal</td><td>Weight</td></tr>
          <tr><td><code>declaredValueUsd</code></td><td>decimal</td><td>Customs value</td></tr>
          <tr><td colspan="3" style="background: var(--bg-primary); color: var(--accent-yellow);">-- Cost Tracking --</td></tr>
          <tr><td><code>productCostPerBottle</code></td><td>decimal</td><td>Ex-cellar cost</td></tr>
          <tr><td><code>freightAllocated</code></td><td>decimal</td><td>Freight portion for this item</td></tr>
          <tr><td><code>handlingAllocated</code></td><td>decimal</td><td>Handling portion</td></tr>
          <tr><td><code>govFeesAllocated</code></td><td>decimal</td><td>Gov fees portion</td></tr>
          <tr><td><code>landedCostTotal</code></td><td>decimal</td><td>Total landed cost (calculated)</td></tr>
          <tr><td><code>landedCostPerBottle</code></td><td>decimal</td><td>Per bottle (calculated)</td></tr>
          <tr><td><code>targetSellingPrice</code></td><td>decimal</td><td>Expected sell price</td></tr>
          <tr><td><code>marginPerBottle</code></td><td>decimal</td><td>Profit per bottle (calculated)</td></tr>
          <tr><td><code>marginPercent</code></td><td>decimal</td><td>Margin % (calculated)</td></tr>
        </tbody>
      </table>

      <h4>logistics_documents</h4>
      <table class="schema-table">
        <thead>
          <tr><th>Column</th><th>Type</th><th>Description</th></tr>
        </thead>
        <tbody>
          <tr><td><code>id</code></td><td>uuid</td><td>PK</td></tr>
          <tr><td><code>shipmentId</code></td><td>uuid FK</td><td>Parent shipment</td></tr>
          <tr><td><code>documentType</code></td><td>enum</td><td>BOL, AWB, invoice, etc.</td></tr>
          <tr><td><code>documentNumber</code></td><td>text</td><td>Reference #</td></tr>
          <tr><td><code>fileUrl</code></td><td>text</td><td>Vercel Blob URL</td></tr>
          <tr><td><code>fileName</code></td><td>text</td><td>Original name</td></tr>
          <tr><td><code>fileSize</code></td><td>integer</td><td>Bytes</td></tr>
          <tr><td><code>mimeType</code></td><td>text</td><td>PDF, image, etc.</td></tr>
          <tr><td><code>issueDate</code></td><td>date</td><td>When issued</td></tr>
          <tr><td><code>expiryDate</code></td><td>date</td><td>For alerts</td></tr>
          <tr><td><code>isRequired</code></td><td>boolean</td><td>Blocks status change</td></tr>
          <tr><td><code>isVerified</code></td><td>boolean</td><td>Admin verified</td></tr>
          <tr><td><code>verifiedBy</code></td><td>uuid FK</td><td>Admin user</td></tr>
          <tr><td><code>verifiedAt</code></td><td>timestamp</td><td></td></tr>
          <tr><td><code>uploadedBy</code></td><td>uuid FK</td><td>Who uploaded</td></tr>
          <tr><td><code>uploadedAt</code></td><td>timestamp</td><td></td></tr>
        </tbody>
      </table>
    </section>

    <section id="workflows">
      <h2>Workflows</h2>

      <div class="card">
        <h3>Inbound Shipment (Partner to UAE)</h3>
        <div class="code-block">1. ADMIN CREATES SHIPMENT
   ├── Select partner
   ├── Enter origin (country, city)
   ├── Set transport mode (sea/air)
   └── Status: draft

2. PARTNER NOTIFIED
   ├── Partner sees shipment in their portal
   └── Partner uploads: commercial invoice, packing list, COO

3. BOOKING CONFIRMED
   ├── Admin enters carrier booking ref
   ├── Add container # or AWB #
   ├── Set ETD/ETA
   └── Status: booked

4. IN TRANSIT
   ├── Auto-track via carrier API (if enabled)
   ├── Manual milestone updates
   └── Status: in_transit

5. ARRIVED AT PORT
   ├── Shipment arrives at UAE port
   └── Status: arrived_port

6. CUSTOMS CLEARANCE
   ├── Upload customs declaration
   ├── Pay government fees
   └── Status: customs_clearance → cleared

7. AT WAREHOUSE
   ├── Goods received at RAK Port
   ├── Verify quantities
   └── Status: at_warehouse

8. COMPLETE
   └── Ready for storage or re-export</div>
      </div>

      <div class="card">
        <h3>Outbound Shipment (UAE to Client)</h3>
        <div class="code-block">1. ADMIN CREATES SHIPMENT
   ├── Select client
   ├── Enter destination
   ├── Add items from warehouse
   └── Status: draft

2. QUOTE SENT (optional)
   ├── Generate quote with costs
   ├── Client accepts/rejects
   └── Quote converted to shipment

3. BOOKING CONFIRMED
   ├── Book with carrier
   ├── Generate export permit
   └── Status: booked

4. DISPATCHED
   ├── Goods leave warehouse
   └── Status: dispatched

5. IN TRANSIT
   ├── Track via carrier
   └── Status: in_transit

6. DELIVERED
   ├── Client confirms receipt
   └── Status: delivered

7. INVOICE
   ├── Generate invoice
   └── Sync to Zoho Books</div>
      </div>

      <div class="card">
        <h3>Document Compliance</h3>
        <div class="code-block">INBOUND - Required Documents:
├── Bill of Lading / Airway Bill  (before departure)
├── Commercial Invoice            (before departure)
├── Packing List                  (before departure)
├── Certificate of Origin         (at customs)
├── Import Permit                 (for alcohol)
└── Customs Declaration           (at arrival)

OUTBOUND - Required Documents:
├── Export Permit                 (before dispatch)
├── Commercial Invoice            (for client)
├── Packing List                  (for client)
└── Delivery Note                 (at delivery)

STATUS BLOCKED IF:
└── Required documents missing or unverified</div>
      </div>
    </section>

    <section id="wireframes">
      <h2>Wireframes</h2>

      <h3>1. Dashboard</h3>
      <div class="wireframe">+-------------------------------------------------------------------+
|  LOGISTICS                                     [+ New Shipment]   |
+-------------------------------------------------------------------+
|  +----------+ +----------+ +----------+ +----------+              |
|  |    12    | |     5    | |     3    | |     8    |              |
|  | In Transit| | Customs  | | At Bond  | |Delivered |              |
|  +----------+ +----------+ +----------+ +----------+              |
|                                                                   |
|  Active Shipments                              [Filter] [Search]  |
|  +---------------------------------------------------------------+|
|  | SHP-2026-0042 | Inbound | Sea | Bordeaux to Dubai             ||
|  | Hapag-Lloyd   | 40 cases | ETA: Jan 18 | In Transit           ||
|  +---------------------------------------------------------------+|
|  | SHP-2026-0041 | Outbound | Air | Dubai to Riyadh              ||
|  | Emirates      | 12 cases | ETD: Jan 14 | Booked               ||
|  +---------------------------------------------------------------+|
|                                                                   |
|  Document Alerts                                                  |
|  ! SHP-0042: Missing Certificate of Origin                       |
|  ! SHP-0038: Import permit expires in 7 days                     |
+-------------------------------------------------------------------+</div>

      <h3>2. Shipment Detail</h3>
      <div class="wireframe">+-------------------------------------------------------------------+
|  &lt; Back                                                          |
|  SHP-2026-0042                                    In Transit      |
|  Inbound Sea Freight (FCL)                                        |
+-------------------------------------------------------------------+
|  [Overview] [Items] [Documents] [Tracking] [Payments]             |
|                                                                   |
|  +---------------------------------------------------------------+|
|  |  ROUTE                                                        ||
|  |  Bordeaux, France  ------------------>  Dubai, UAE            ||
|  |  Departed: Jan 5        ######--   ETA: Jan 18                ||
|  +---------------------------------------------------------------+|
|                                                                   |
|  Partner                        Carrier                           |
|  -----------                    -----------                       |
|  Bordeaux Direct                Hapag-Lloyd                       |
|  contact@bordeaux.fr            Container: HLCU1234567            |
|                                 BOL: HLCU2026001234               |
|                                 [Track on Hapag-Lloyd ->]         |
|                                                                   |
|  Documents (4/6)                                                  |
|  ---------------------------------------------------------------- |
|  [x] Bill of Lading           [x] Commercial Invoice              |
|  [x] Packing List             [ ] Certificate of Origin           |
|  [ ] Import Permit            [ ] Customs Declaration             |
|                                                                   |
|  [Upload Document]  [Update Status v]  [Edit Shipment]            |
+-------------------------------------------------------------------+</div>

      <h3>3. Shipment Cost Breakdown (Admin)</h3>
      <div class="wireframe">+-------------------------------------------------------------------+
|  [Overview] [Items] [Documents] [Tracking] [Costs]                |
+-------------------------------------------------------------------+
|  COST BREAKDOWN                         Allocation: [Bottles v]   |
|                                                                   |
|  Shipment Costs                                                   |
|  +---------------------------------------------------------------+|
|  | Product Cost (ex-cellar)                        $5,760.00     ||
|  | Freight (Bordeaux to Dubai)                     $2,400.00     ||
|  | Insurance (0.5%)                                  $120.00     ||
|  | Origin handling                                   $150.00     ||
|  | Destination handling                              $200.00     ||
|  | Customs clearance                                 $180.00     ||
|  | Government fees                                   $150.00     ||
|  | Delivery to RAK Port                              $100.00     ||
|  | ----------------------------------------------------------    ||
|  | TOTAL LANDED COST                               $9,060.00     ||
|  | / 480 bottles                                                 ||
|  | = COST PER BOTTLE                                  $18.88     ||
|  +---------------------------------------------------------------+|
|                                                                   |
|  Per-Item Breakdown                                               |
|  +---------------------------------------------------------------+|
|  | Product           |Bottles| Landed |Per Btl|Target|Margin     ||
|  +---------------------------------------------------------------+|
|  | Margaux 2018      |  144  | $2,718 |$18.88 |$35.00| 85%       ||
|  | Latour 2019       |  240  | $4,531 |$18.88 |$28.00| 48%       ||
|  | Dom Perignon 2012 |   96  | $1,811 |$18.88 |$45.00|138%       ||
|  +---------------------------------------------------------------+|
|                                                                   |
|  [Export to Excel]  [Update Costs]                                |
+-------------------------------------------------------------------+</div>
    </section>

    <section id="integrations">
      <h2>Integrations</h2>

      <div class="card">
        <h3>Hillebrand API (Primary)</h3>
        <p><strong>Purpose:</strong> Get quotes, book shipments, track shipments</p>
        <div class="code-block">API Details (from OpenAPI spec):
Base URL: https://api.hillebrandgori.com/
Auth: OAuth2 password grant
Token URL: https://login.hillebrand.com/oauth2/aus95hq7r8iIqp14M0i7/v1/token
Token expiry: 2 hours
Rate limit: 100 calls/minute

Available Endpoints:
| Endpoint                   | Method | Purpose                    |
|----------------------------|--------|----------------------------|
| /v6/shipments              | GET    | List shipments with filters|
| /v6/shipments/{id}         | GET    | Get shipment details       |
| /v6/invoices               | GET    | Get invoice data           |
| /v1/webhooks/me            | CRUD   | Manage webhook subscriptions|
| /v1/webhooks/me/eventTypes | GET    | List available event types |

Webhook Events (real-time push):
Ship from:       shprdy (ready), shpsupdeppln/cnf (departure)
Consolidation:   shpexharrpln/cnf, shpexhdeppln/cnf
Port loading:    shppolarrcnf, shpprtdeppln/cnf
Transshipment:   shppoxarrpln/cnf, shppoxdeppln/cnf
Port arrival:    shpprtarrpln/cnf, shppoddepcnf
Customs:         shpimpcsmclr (cleared)
Deconsolidation: shpimharrpln/cnf, shpimhdeppln/cnf
Ship to:         shpcusarrpln/cnf (final delivery)</div>
      </div>

      <div class="card">
        <h3>Hapag-Lloyd API (Secondary)</h3>
        <p><strong>Purpose:</strong> Track sea freight containers</p>
        <div class="code-block">API: DCSA Track & Trace v2.2 (FREE)

// Track container
GET https://api.hlag.com/v2/events?equipmentReference={containerNumber}
Headers: { 'API-Key': process.env.HAPAG_LLOYD_API_KEY }

Returns: array of tracking events
{
  eventType: 'ARRI',
  eventDateTime: '2026-01-18T08:30:00Z',
  location: { name: 'Jebel Ali Port', UNLocationCode: 'AEJEA' }
}</div>
      </div>

      <div class="card">
        <h3>Zoho Books API</h3>
        <p><strong>Purpose:</strong> Sync invoices and payments</p>
        <div class="code-block">Authentication: OAuth2

// Sync invoice to Zoho
POST https://books.zoho.com/api/v3/invoices
{
  customer_id: zohoContactId,
  invoice_number: 'LGI-2026-0001',
  date: '2026-01-15',
  due_date: '2026-02-15',
  line_items: [
    { description: 'Freight - Dubai to Riyadh', amount: 1620 },
    { description: 'Handling', amount: 150 },
    { description: 'C&C Margin', amount: 212 }
  ]
}</div>
      </div>
    </section>

    <section id="pre-work">
      <h2>Pre-Work: Fix Local Inventory Sync</h2>

      <div class="pre-work-card">
        <h3>Problem: Only 212 of ~300 SKUs importing from Google Sheet</h3>

        <p><strong>Root Cause:</strong> Current sync skips rows with missing/invalid data instead of matching to LWIN database</p>

        <h4>Current Flow (broken)</h4>
        <div class="code-block">Sheet Row -> Validate fields -> Skip if invalid -> Create product from raw data</div>

        <h4>New Flow (like Source module)</h4>
        <div class="code-block">Sheet Row
    |
Has LWIN18? --Yes--> Lookup lwinWines by LWIN18
    |                      |
    No              Found? --Yes--> Use LWIN data --> Create/update product
    |                      |
Fuzzy match by             No
Description                |
    |                 Log warning: "Invalid LWIN18: {value}"
Found? --Yes--> Use LWIN data --> Create/update product
    |
    No
    |
Flag for manual review (don't skip silently)</div>

        <h4>Files to Modify</h4>
        <ul>
          <li><code>apps/web/src/app/_products/utils/parseLocalInventorySheet.ts</code> - Add LWIN lookup/matching</li>
          <li><code>apps/web/src/app/_products/controller/localInventorySyncController.ts</code> - Handle unmatched items</li>
        </ul>

        <h4>Changes</h4>
        <ol>
          <li>Import <code>matchLwinWines</code> utility from <code>_source/utils/</code></li>
          <li>If LWIN18 present: Query <code>lwinWines</code> table by LWIN18</li>
          <li>If LWIN18 missing: Fuzzy match by Description using trigram similarity</li>
          <li>Use LWIN data (displayName, producer, region) instead of raw sheet data</li>
          <li>Log/flag unmatched rows instead of silently skipping</li>
          <li>Return match statistics: <code>{ matched: X, unmatched: Y, total: Z }</code></li>
        </ol>

        <h4>Benefits</h4>
        <ul>
          <li>All ~300 rows processed (not 212)</li>
          <li>Validated product data from LWIN database</li>
          <li>Consistent with Source module pattern</li>
          <li>Visibility into unmatched items</li>
        </ul>
      </div>
    </section>

    <section id="phases">
      <h2>Implementation Phases</h2>

      <div class="phase-card">
        <h3>Phase 1: Foundation (START HERE)</h3>
        <p><strong>Goal:</strong> Core database schema + basic shipment CRUD + document upload</p>

        <h4>Database Tasks</h4>
        <ul class="task-list">
          <li>Add 5 enums to <code>schema.ts</code>: <code>shipmentType</code>, <code>transportMode</code>, <code>shipmentStatus</code>, <code>logisticsDocumentType</code>, <code>portLocation</code></li>
          <li>Add <code>shipments</code> table (follows <code>privateClientOrders</code> pattern)</li>
          <li>Add <code>shipmentItems</code> table (follows <code>privateClientOrderItems</code> pattern)</li>
          <li>Add <code>logisticsDocuments</code> table (follows <code>privateClientOrderDocuments</code> pattern exactly)</li>
          <li>Add <code>shipmentActivityLogs</code> table (follows <code>privateClientOrderActivityLogs</code> pattern)</li>
          <li>Add <code>logisticsRateCards</code> table (for RAK Port rates)</li>
          <li>Add relations in <code>relations.ts</code></li>
          <li>Run <code>pnpm drizzle-kit generate && pnpm drizzle-kit migrate</code></li>
        </ul>

        <h4>API Tasks</h4>
        <ul class="task-list">
          <li>Create <code>_logistics/router.ts</code> with admin/partner/client sub-routers</li>
          <li>Create <code>_logistics/utils/generateShipmentNumber.ts</code> (follow <code>generateRfqNumber.ts</code>)</li>
          <li>Create <code>_logistics/schemas/createShipmentSchema.ts</code></li>
          <li>Create admin controllers: <code>adminCreate.ts</code>, <code>adminGetMany.ts</code>, <code>adminGetOne.ts</code>, <code>adminUpdate.ts</code>, <code>adminUpdateStatus.ts</code></li>
          <li>Create <code>adminUploadDocument.ts</code> (copy from <code>_privateClientOrders/controller/documentsUpload.ts</code>)</li>
          <li>Register router in <code>lib/trpc/root.ts</code></li>
        </ul>
      </div>

      <div class="phase-card">
        <h3>Phase 2: Landed Cost Calculator</h3>
        <p><strong>Goal:</strong> Calculate true cost per bottle using RAK Port rates</p>

        <ul class="task-list">
          <li>Create <code>_logistics/utils/calculateLandedCost.ts</code> with formula</li>
          <li>Seed RAK Port rate card: destuffing (670/875 AED), non-duty levy (1.60/case), delivery (600/1000 AED)</li>
          <li>Add <code>adminCalculateLandedCost.ts</code> controller</li>
          <li>Auto-recalculate on item/cost changes</li>
          <li>Add cost allocation method selector (by bottles, weight, value)</li>
        </ul>
      </div>

      <div class="phase-card">
        <h3>Phase 3: AI Document Extraction</h3>
        <p><strong>Goal:</strong> Auto-extract fields from BOL, AWB, commercial invoices</p>

        <ul class="task-list">
          <li>Create <code>trigger/jobs/extract-logistics-document/extractLogisticsDocumentJob.ts</code></li>
          <li>Follow <code>extractDocumentJob.ts</code> pattern exactly (OpenAI Vision gpt-4o)</li>
          <li>Extract fields by document type (BOL/AWB, Invoice, Packing List)</li>
          <li>Auto-populate shipment fields from extracted data</li>
          <li>Update extraction status: pending to processing to completed/failed</li>
        </ul>
      </div>

      <div class="phase-card">
        <h3>Phase 4: Admin UI</h3>
        <p><strong>Goal:</strong> Full admin interface for managing shipments</p>

        <h4>Navigation Redesign: Two-Row Header</h4>
        <div class="nav-redesign">Current (crowded single row):
QUOTES: Create | My Quotes | Approvals   PRIVATE ORDERS: Dashboard | Manage   PRICING: Calculator

New design (two rows):
+-------------------------------------------------------------------+
| [C&C INDEX]         Quotes    Orders    Logistics    Pricing      |  &lt;- Primary nav (modules)
+-------------------------------------------------------------------+
| Shipments    Documents    Tools    Costs                          |  &lt;- Secondary nav (context-aware)
+-------------------------------------------------------------------+

Secondary nav changes per module:
| Module    | Secondary Nav Items               |
|-----------|-----------------------------------|
| Quotes    | Create, My Quotes, Approvals      |
| Orders    | Dashboard, Manage                 |
| Logistics | Shipments, Documents, Tools, Costs|
| Pricing   | Calculator                        |</div>

        <h4>Pages</h4>
        <ul class="task-list">
          <li><code>/platform/admin/logistics/page.tsx</code> - Dashboard with status counts</li>
          <li><code>/platform/admin/logistics/shipments/page.tsx</code> - Shipment list with filters</li>
          <li><code>/platform/admin/logistics/shipments/new/page.tsx</code> - Create shipment form</li>
          <li><code>/platform/admin/logistics/shipments/[id]/page.tsx</code> - Shipment detail with tabs</li>
          <li><code>/platform/admin/logistics/tools/page.tsx</code> - Admin tools index</li>
          <li><code>/platform/admin/logistics/tools/pdf-extract/page.tsx</code> - PDF to Excel tool</li>
        </ul>
      </div>

      <div class="phase-card">
        <h3>Phase 5: Partner & Client Portals</h3>
        <p><strong>Goal:</strong> Role-based views for partners and clients</p>

        <h4>Partner Portal</h4>
        <ul class="task-list">
          <li><code>partnerGetMany.ts</code> - Filter by <code>partnerId</code> from context</li>
          <li><code>partnerGetOne.ts</code> - Verify partner access</li>
          <li><code>partnerUploadDocument.ts</code> - Partners can upload docs for their shipments</li>
          <li><code>/platform/partner/logistics/page.tsx</code> - Partner shipment list</li>
        </ul>

        <h4>Client Portal</h4>
        <ul class="task-list">
          <li><code>clientGetMany.ts</code> - Filter by linked orders</li>
          <li><code>clientTrackShipment.ts</code> - Read-only tracking view</li>
          <li><code>/platform/client/logistics/page.tsx</code> - Client tracking view</li>
        </ul>
      </div>

      <div class="phase-card">
        <h3>Phase 6: Hillebrand API Integration</h3>
        <p><strong>Goal:</strong> Live tracking from Hillebrand (API credentials available)</p>

        <ul class="task-list">
          <li>Store credentials in env: <code>HILLEBRAND_API_KEY</code>, <code>HILLEBRAND_API_SECRET</code>, <code>HILLEBRAND_USERNAME</code>, <code>HILLEBRAND_PASSWORD</code></li>
          <li>Create <code>_logistics/integrations/hillebrand/client.ts</code> - OAuth2 token management</li>
          <li>Create <code>_logistics/integrations/hillebrand/getShipments.ts</code> - List shipments</li>
          <li>Create <code>_logistics/integrations/hillebrand/getShipment.ts</code> - Get details</li>
          <li>Create <code>api/webhooks/hillebrand/route.ts</code> - Webhook receiver</li>
          <li>Create Trigger.dev job for periodic sync (backup to webhooks)</li>
          <li>Map Hillebrand status to our shipmentStatus enum</li>
        </ul>
      </div>

      <div class="phase-card">
        <h3>Phase 7: Quotes & Invoicing (DEFERRED)</h3>
        <p><strong>Goal:</strong> Generate logistics quotes, sync invoices to Zoho</p>

        <ul class="task-list">
          <li>Logistics quotes table and CRUD</li>
          <li>Quote builder with rate calculation</li>
          <li>Invoice generation from shipment costs</li>
          <li>Zoho Books sync</li>
        </ul>
      </div>
    </section>

    <section id="admin-tools">
      <h2>Admin Tools</h2>

      <div class="card">
        <h3>1. PDF to Excel Extraction Tool</h3>
        <p><strong>Purpose:</strong> Upload any PDF (invoice, packing list, BOL) and extract structured data to Excel</p>
        <p><strong>Location:</strong> <code>/platform/admin/logistics/tools/pdf-extract</code></p>

        <div class="code-block">How it works:
1. Admin uploads PDF
2. AI (OpenAI Vision gpt-4o) extracts structured data
3. Preview extracted data in table format
4. Download as Excel (.xlsx)

Extraction Focus: Line items only (not headers/totals)

Commercial Invoice - Line Items:
| Field            | Description           | Example            |
|------------------|-----------------------|--------------------|
| Product Name     | Wine/spirit name      | "Chateau Margaux"  |
| Vintage          | Year                  | 2018               |
| Producer         | Winery/distillery     | "Chateau Margaux"  |
| Region           | Wine region           | "Bordeaux"         |
| Country of Origin| COO                   | "France"           |
| HS Code          | Customs code          | "2204.21.00"       |
| Cases            | Quantity in cases     | 20                 |
| Case Config      | Bottles per case      | 12                 |
| Bottle Size      | ml                    | 750                |
| Unit Price       | Per case              | $240.00            |
| Total            | Line total            | $4,800.00          |
| Currency         |                       | USD                |

Use Case:
Supplier PDF (invoice/packing list)
        |
   AI Extraction
        |
   Excel Download
        |
   Send to Clearing Agent
        |
   Agent uploads to Customs System</div>
      </div>

      <div class="card">
        <h3>2. Document Version Management</h3>
        <p><strong>Purpose:</strong> Store original, final, and extracted versions side-by-side for each document</p>

        <div class="code-block">Three Versions Per Document:
| Version         | Description                      | When Created       |
|-----------------|----------------------------------|--------------------|
| Original Draft  | First uploaded PDF from supplier | On initial upload  |
| Final Signed    | Signed/stamped version after customs | After clearance |
| Excel Extract   | AI-extracted line items as .xlsx | After AI extraction|

Workflow:
1. Upload Invoice PDF -> Stored as "Original Draft"
                      -> AI extracts line items
                      -> Excel generated & stored as "Excel Extract"

2. Customs clears shipment

3. Upload signed copy -> Stored as "Final Signed"
                      -> All 3 versions now available side-by-side</div>
      </div>
    </section>

    <section id="files">
      <h2>Key Files to Create</h2>
      <div class="code-block">apps/web/src/
├── database/
│   ├── schema.ts                   -> Add 5 enums, 5 tables
│   └── relations.ts                -> Add logistics relations
├── lib/trpc/root.ts                -> Register logisticsRouter
└── app/
    ├── _logistics/
    │   ├── router.ts               -> Main router (admin/partner/client)
    │   ├── controller/
    │   │   ├── adminCreate.ts
    │   │   ├── adminGetMany.ts
    │   │   ├── adminGetOne.ts
    │   │   ├── adminUpdate.ts
    │   │   ├── adminUpdateStatus.ts
    │   │   ├── adminUploadDocument.ts
    │   │   ├── adminDeleteDocument.ts
    │   │   ├── adminAddItem.ts
    │   │   ├── adminCalculateLandedCost.ts
    │   │   ├── partnerGetMany.ts
    │   │   ├── partnerGetOne.ts
    │   │   ├── partnerUploadDocument.ts
    │   │   ├── clientGetMany.ts
    │   │   └── clientTrackShipment.ts
    │   ├── schemas/
    │   │   ├── createShipmentSchema.ts
    │   │   ├── updateShipmentSchema.ts
    │   │   ├── getShipmentsSchema.ts
    │   │   ├── uploadDocumentSchema.ts
    │   │   └── addItemSchema.ts
    │   └── utils/
    │       ├── generateShipmentNumber.ts
    │       ├── calculateLandedCost.ts
    │       └── validateStatusTransition.ts
    │
    └── (routes)/platform/
        ├── admin/logistics/
        │   ├── page.tsx            -> Dashboard
        │   └── shipments/
        │       ├── page.tsx        -> Shipment list
        │       ├── new/page.tsx    -> Create form
        │       └── [id]/page.tsx   -> Detail (tabbed)
        ├── partner/logistics/
        │   └── page.tsx            -> Partner view
        └── client/logistics/
            └── page.tsx            -> Client tracking

apps/web/src/trigger/jobs/
└── extract-logistics-document/
    └── extractLogisticsDocumentJob.ts</div>

      <h3>Critical Reference Files (Copy Patterns From)</h3>
      <table class="reference-table">
        <thead>
          <tr><th>New File</th><th>Copy Pattern From</th></tr>
        </thead>
        <tbody>
          <tr><td><code>_logistics/router.ts</code></td><td><code>_source/router.ts</code> - hierarchical router structure</td></tr>
          <tr><td><code>adminCreate.ts</code></td><td><code>_source/controller/adminCreateRfq.ts</code> - admin procedure pattern</td></tr>
          <tr><td><code>adminGetMany.ts</code></td><td><code>_source/controller/adminGetManyRfqs.ts</code> - pagination/filtering</td></tr>
          <tr><td><code>adminUploadDocument.ts</code></td><td><code>_privateClientOrders/controller/documentsUpload.ts</code> - <strong>exact copy</strong></td></tr>
          <tr><td><code>generateShipmentNumber.ts</code></td><td><code>_source/utils/generateRfqNumber.ts</code> - number generation</td></tr>
          <tr><td><code>extractLogisticsDocumentJob.ts</code></td><td><code>trigger/jobs/extract-document/extractDocumentJob.ts</code> - AI extraction</td></tr>
          <tr><td><code>shipments</code> table</td><td><code>privateClientOrders</code> table - similar structure</td></tr>
          <tr><td><code>logisticsDocuments</code> table</td><td><code>privateClientOrderDocuments</code> table - <strong>exact pattern</strong></td></tr>
          <tr><td><code>shipmentActivityLogs</code> table</td><td><code>privateClientOrderActivityLogs</code> table - audit pattern</td></tr>
        </tbody>
      </table>
    </section>

    <section id="verification">
      <h2>Verification Checklist</h2>

      <div class="card">
        <h3>Phase 1 Verification</h3>
        <div class="code-block"># 1. Database migration
cd apps/web
pnpm drizzle-kit generate
pnpm drizzle-kit migrate
# Check tables in Neon dashboard

# 2. Dev server
pnpm dev

# 3. API tests (use tRPC devtools or curl)
# - Create shipment: logistics.admin.create
# - List shipments: logistics.admin.getMany
# - Get one: logistics.admin.getOne
# - Update status: logistics.admin.updateStatus
# - Upload document: logistics.admin.uploadDocument

# 4. Verify in Neon
# - shipments table has records
# - shipment_activity_logs has status change entries
# - logistics_documents has uploaded file record

# 5. Verify Vercel Blob
# - Document URL accessible
# - File content correct</div>
      </div>

      <div class="card">
        <h3>End-to-End Test Scenario</h3>
        <ol>
          <li>Create shipment: Inbound, Sea FCL, from UK Bonded to RAK Port</li>
          <li>Add items: 20 cases Chateau Margaux 2018</li>
          <li>Upload BOL document (PDF)</li>
          <li>Verify AI extraction triggered (check Trigger.dev dashboard)</li>
          <li>Update status: draft to booked to in_transit</li>
          <li>Check activity log shows all transitions</li>
          <li>Calculate landed cost with RAK Port rates</li>
        </ol>
      </div>
    </section>

    <footer>
      <p>C&C Logistics Module Implementation Plan</p>
      <p>Last updated: January 2026</p>
    </footer>
  </div>
</body>
</html>
