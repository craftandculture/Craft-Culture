<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WMS User Guide - Craft & Culture</title>
  <style>
    :root {
      --primary: #7c3aed;
      --primary-light: #ede9fe;
      --success: #10b981;
      --success-light: #d1fae5;
      --warning: #f59e0b;
      --warning-light: #fef3c7;
      --danger: #ef4444;
      --danger-light: #fee2e2;
      --info: #3b82f6;
      --info-light: #dbeafe;
      --text: #1f2937;
      --text-muted: #6b7280;
      --border: #e5e7eb;
      --bg: #f9fafb;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      line-height: 1.6;
      color: var(--text);
      max-width: 1000px;
      margin: 0 auto;
      padding: 2rem;
      background: white;
    }

    h1 { color: var(--primary); margin-bottom: 0.5rem; font-size: 2rem; }
    h2 { color: var(--text); margin-top: 2.5rem; margin-bottom: 1rem; padding-bottom: 0.5rem; border-bottom: 2px solid var(--primary); }
    h3 { color: var(--text); margin-top: 1.5rem; margin-bottom: 0.75rem; }
    h4 { color: var(--text-muted); margin-top: 1rem; margin-bottom: 0.5rem; font-size: 0.95rem; text-transform: uppercase; letter-spacing: 0.05em; }
    p { margin-bottom: 1rem; }
    .subtitle { color: var(--text-muted); font-size: 1.1rem; margin-bottom: 2rem; }

    .status-box { padding: 1rem; border-radius: 8px; margin: 1rem 0; }
    .status-success { background: var(--success-light); border-left: 4px solid var(--success); }
    .status-warning { background: var(--warning-light); border-left: 4px solid var(--warning); }
    .status-info { background: var(--info-light); border-left: 4px solid var(--info); }
    .status-danger { background: var(--danger-light); border-left: 4px solid var(--danger); }

    table { width: 100%; border-collapse: collapse; margin: 1rem 0; }
    th, td { padding: 0.75rem; text-align: left; border-bottom: 1px solid var(--border); }
    th { background: var(--bg); font-weight: 600; }
    tr:hover { background: var(--bg); }

    .badge { display: inline-block; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.75rem; font-weight: 600; }
    .badge-success { background: var(--success-light); color: #065f46; }
    .badge-warning { background: var(--warning-light); color: #92400e; }
    .badge-danger { background: var(--danger-light); color: #991b1b; }
    .badge-info { background: var(--info-light); color: #1e40af; }
    .badge-neutral { background: var(--bg); color: var(--text-muted); }

    ul, ol { margin-left: 1.5rem; margin-bottom: 1rem; }
    li { margin-bottom: 0.5rem; }
    code { background: var(--bg); padding: 0.2rem 0.4rem; border-radius: 4px; font-family: 'Monaco', 'Consolas', monospace; font-size: 0.9em; }

    .workflow-step { display: flex; align-items: flex-start; gap: 1rem; margin: 1rem 0; padding: 1rem; background: var(--bg); border-radius: 8px; }
    .step-number { width: 32px; height: 32px; background: var(--primary); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; flex-shrink: 0; }

    .checklist { list-style: none; margin-left: 0; }
    .checklist li { padding: 0.5rem 0; padding-left: 2rem; position: relative; border-bottom: 1px solid var(--border); }
    .checklist li:last-child { border-bottom: none; }
    .checklist li::before { content: "â˜"; position: absolute; left: 0; font-size: 1.2em; }

    .toc { background: var(--primary-light); padding: 1.5rem; border-radius: 8px; margin-bottom: 2rem; }
    .toc h3 { margin-top: 0; }
    .toc ul { margin-bottom: 0; columns: 2; }
    .toc a { color: var(--primary); text-decoration: none; }
    .toc a:hover { text-decoration: underline; }

    .nav-path { background: var(--bg); padding: 0.5rem 1rem; border-radius: 4px; font-family: monospace; margin: 0.5rem 0; display: inline-block; }

    .feature-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 1rem; margin: 1rem 0; }
    .feature-card { background: white; border: 1px solid var(--border); border-radius: 8px; padding: 1rem; }
    .feature-card h4 { margin-top: 0; color: var(--text); text-transform: none; letter-spacing: normal; font-size: 1rem; }
    .feature-card p { margin-bottom: 0.5rem; font-size: 0.9rem; color: var(--text-muted); }

    @media print { body { max-width: 100%; padding: 1rem; } .status-box, .toc { break-inside: avoid; } }
    @media (max-width: 600px) { .toc ul { columns: 1; } .feature-grid { grid-template-columns: 1fr; } }
  </style>
</head>
<body>
  <h1>WMS User Guide</h1>
  <p class="subtitle">Warehouse Management System for Craft & Culture</p>

  <div class="toc">
    <h3>Contents</h3>
    <ul>
      <li><a href="#overview">System Overview</a></li>
      <li><a href="#integration">System Integration & Flows</a></li>
      <li><a href="#navigation">Navigation Guide</a></li>
      <li><a href="#features">Feature Status</a></li>
      <li><a href="#receiving">Receiving Workflow</a></li>
      <li><a href="#stock">Stock Management</a></li>
      <li><a href="#operations">Warehouse Operations</a></li>
      <li><a href="#picking">Picking & Dispatch</a></li>
      <li><a href="#testing">Testing Checklist</a></li>
      <li><a href="#hardware">Hardware Setup</a></li>
      <li><a href="#troubleshooting">Troubleshooting</a></li>
    </ul>
  </div>

  <h2 id="overview">System Overview</h2>

  <p>The WMS is a custom warehouse management system built for Craft & Culture to manage wine inventory with barcode scanning, multi-owner stock tracking, and integration with the Logistics module.</p>

  <h3>Key Concepts</h3>
  <table>
    <tr><th>Concept</th><th>Description</th><th>Example</th></tr>
    <tr>
      <td><strong>Location</strong></td>
      <td>A bin in the warehouse (Aisle-Bay-Level)</td>
      <td><code>A-01-02</code> = Aisle A, Bay 01, Level 02</td>
    </tr>
    <tr>
      <td><strong>LWIN-18</strong></td>
      <td>Unique product code including vintage and pack config</td>
      <td><code>1010279-2015-06-00750</code></td>
    </tr>
    <tr>
      <td><strong>Case Barcode</strong></td>
      <td>Unique barcode per physical case</td>
      <td><code>CASE-1010279-2015-06-00750-001</code></td>
    </tr>
    <tr>
      <td><strong>Location Barcode</strong></td>
      <td>Scannable label on each bay</td>
      <td><code>LOC-A-01-02</code></td>
    </tr>
    <tr>
      <td><strong>Movement</strong></td>
      <td>Audit trail entry for any stock action</td>
      <td>receive, transfer, pick, adjust</td>
    </tr>
    <tr>
      <td><strong>Owner</strong></td>
      <td>Partner who owns the stock</td>
      <td>Cru Wine, Crurated, C&C</td>
    </tr>
  </table>

  <h3>Database Tables</h3>
  <p>The WMS uses 14 database tables:</p>
  <ul>
    <li><code>wms_locations</code> - Warehouse bin locations</li>
    <li><code>wms_stock</code> - Stock records (quantity by product/location/owner)</li>
    <li><code>wms_stock_movements</code> - Complete audit trail</li>
    <li><code>wms_case_labels</code> - Individual case barcodes</li>
    <li><code>wms_receiving_drafts</code> - Saved receiving progress</li>
    <li><code>wms_pick_lists</code> / <code>wms_pick_list_items</code> - Order picking</li>
    <li><code>wms_dispatch_batches</code> / <code>wms_dispatch_batch_orders</code> - Dispatch batching</li>
    <li><code>wms_delivery_notes</code> - Delivery documentation</li>
    <li><code>wms_repacks</code> - Pack conversion history</li>
    <li><code>wms_partner_requests</code> - Partner transfer requests</li>
    <li><code>wms_pallets</code> / <code>wms_pallet_cases</code> - Customer storage</li>
    <li><code>wms_storage_charges</code> - Storage billing</li>
  </ul>

  <h2 id="integration">System Integration & Flow Diagrams</h2>

  <p>This section shows how WMS integrates with other systems and the complete flow from shipment to dispatch.</p>

  <h3>High-Level Architecture</h3>
  <div style="background: #1e293b; color: #e2e8f0; padding: 1.5rem; border-radius: 8px; font-family: monospace; font-size: 0.85rem; line-height: 1.4; overflow-x: auto; white-space: pre;">
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           CRAFT & CULTURE PLATFORM                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚   PARTNERS   â”‚      â”‚   LOGISTICS  â”‚      â”‚     WMS      â”‚      â”‚   ORDERS   â”‚  â”‚
â”‚   â”‚              â”‚      â”‚              â”‚      â”‚              â”‚      â”‚            â”‚  â”‚
â”‚   â”‚ â€¢ Suppliers  â”‚â”€â”€â”€â”€â”€â–¶â”‚ â€¢ Shipments  â”‚â”€â”€â”€â”€â”€â–¶â”‚ â€¢ Stock      â”‚â—€â”€â”€â”€â”€â”€â”‚ â€¢ Private  â”‚  â”‚
â”‚   â”‚ â€¢ Brands     â”‚      â”‚ â€¢ Documents  â”‚      â”‚ â€¢ Locations  â”‚      â”‚   Client   â”‚  â”‚
â”‚   â”‚ â€¢ Customers  â”‚      â”‚ â€¢ Tracking   â”‚      â”‚ â€¢ Movements  â”‚â”€â”€â”€â”€â”€â–¶â”‚ â€¢ B2B      â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚          â”‚                     â”‚                     â”‚                     â”‚         â”‚
â”‚          â”‚                     â”‚                     â”‚                     â”‚         â”‚
â”‚          â–¼                     â–¼                     â–¼                     â–¼         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚                              DATABASE (PostgreSQL)                            â”‚  â”‚
â”‚   â”‚  partners | logistics_shipments | wms_stock | wms_movements | orders         â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚   TRIGGER    â”‚      â”‚    ZEBRA     â”‚      â”‚    ZOHO      â”‚      â”‚  PARTNER   â”‚  â”‚
â”‚   â”‚    .DEV      â”‚      â”‚   HARDWARE   â”‚      â”‚   (FUTURE)   â”‚      â”‚   PORTAL   â”‚  â”‚
â”‚   â”‚              â”‚      â”‚              â”‚      â”‚              â”‚      â”‚            â”‚  â”‚
â”‚   â”‚ â€¢ Auto jobs  â”‚      â”‚ â€¢ TC27 Scan  â”‚      â”‚ â€¢ Invoices   â”‚      â”‚ â€¢ Stock    â”‚  â”‚
â”‚   â”‚ â€¢ Schedules  â”‚      â”‚ â€¢ ZD421 Printâ”‚      â”‚ â€¢ Payments   â”‚      â”‚   View     â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  </div>

  <h3>End-to-End Flow: Inbound Stock</h3>
  <p>Complete flow from partner shipment to stock available in warehouse:</p>

  <div style="background: #1e293b; color: #e2e8f0; padding: 1.5rem; border-radius: 8px; font-family: monospace; font-size: 0.8rem; line-height: 1.5; overflow-x: auto; white-space: pre;">
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  LOGISTICS MODULE                           â”‚  WMS MODULE                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                             â”‚                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚                                            â”‚
â”‚  â”‚  1. CREATE SHIPMENT â”‚                    â”‚                                            â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚                    â”‚                                            â”‚
â”‚  â”‚  â€¢ Partner assigned  â”‚                    â”‚                                            â”‚
â”‚  â”‚  â€¢ Items with LWIN  â”‚                    â”‚                                            â”‚
â”‚  â”‚  â€¢ Expected qty     â”‚                    â”‚                                            â”‚
â”‚  â”‚  â€¢ Commercial inv.  â”‚                    â”‚                                            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚                                            â”‚
â”‚             â”‚                               â”‚                                            â”‚
â”‚             â–¼                               â”‚                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚                                            â”‚
â”‚  â”‚  2. SHIPMENT IN     â”‚                    â”‚                                            â”‚
â”‚  â”‚     TRANSIT         â”‚                    â”‚                                            â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚                    â”‚                                            â”‚
â”‚  â”‚  Status: 'shipped'  â”‚                    â”‚                                            â”‚
â”‚  â”‚  Tracking updates   â”‚                    â”‚                                            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚                                            â”‚
â”‚             â”‚                               â”‚                                            â”‚
â”‚             â”‚   status = 'delivered'        â”‚                                            â”‚
â”‚             â”‚   OR manually triggered       â”‚                                            â”‚
â”‚             â”‚                               â”‚                                            â”‚
â”‚             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚                                             â”‚   â”‚  3. RECEIVE SHIPMENT â”‚                  â”‚
â”‚                                             â”‚   â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚                  â”‚
â”‚  DOCUMENTS OUTPUT:                          â”‚   â”‚  â€¢ Verify quantities â”‚                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                          â”‚   â”‚  â€¢ Assign locations  â”‚                  â”‚
â”‚  ğŸ“„ Commercial Invoice                      â”‚   â”‚  â€¢ Print case labels â”‚                  â”‚
â”‚  ğŸ“„ Packing List                            â”‚   â”‚  â€¢ Scan bay barcodes â”‚                  â”‚
â”‚  ğŸ“„ AWB / Bill of Lading                    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                             â”‚              â”‚                              â”‚
â”‚                                             â”‚              â–¼                              â”‚
â”‚                                             â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚                                             â”‚   â”‚  4. STOCK CREATED   â”‚                  â”‚
â”‚                                             â”‚   â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚                  â”‚
â”‚                                             â”‚   â”‚  wms_stock records  â”‚                  â”‚
â”‚                                             â”‚   â”‚  wms_case_labels    â”‚                  â”‚
â”‚                                             â”‚   â”‚  wms_movements      â”‚                  â”‚
â”‚                                             â”‚   â”‚  (type: 'receive')  â”‚                  â”‚
â”‚                                             â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                             â”‚              â”‚                              â”‚
â”‚                                             â”‚              â–¼                              â”‚
â”‚                                             â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚                                             â”‚   â”‚  5. STOCK AVAILABLE â”‚                  â”‚
â”‚                                             â”‚   â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚                  â”‚
â”‚                                             â”‚   â”‚  Dashboard shows qtyâ”‚                  â”‚
â”‚                                             â”‚   â”‚  Available for pick â”‚                  â”‚
â”‚                                             â”‚   â”‚  Partner can view   â”‚                  â”‚
â”‚                                             â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                             â”‚                                            â”‚
â”‚                                             â”‚   DOCUMENTS OUTPUT:                        â”‚
â”‚                                             â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                        â”‚
â”‚                                             â”‚   ğŸ·ï¸ Case Labels (ZPL)                     â”‚
â”‚                                             â”‚   ğŸ“Š Receiving Report                      â”‚
â”‚                                             â”‚   ğŸ“¸ Receiving Photos                      â”‚
â”‚                                             â”‚                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  </div>

  <h3>End-to-End Flow: Outbound (Picking & Dispatch)</h3>
  <p>Flow from order placement to dispatch:</p>

  <div style="background: #1e293b; color: #e2e8f0; padding: 1.5rem; border-radius: 8px; font-family: monospace; font-size: 0.8rem; line-height: 1.5; overflow-x: auto; white-space: pre;">
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ORDERS MODULE                              â”‚  WMS MODULE                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                             â”‚                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚                                            â”‚
â”‚  â”‚  1. ORDER CREATED   â”‚                    â”‚                                            â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚                    â”‚                                            â”‚
â”‚  â”‚  â€¢ Private Client   â”‚                    â”‚                                            â”‚
â”‚  â”‚  â€¢ B2B Order        â”‚                    â”‚                                            â”‚
â”‚  â”‚  â€¢ Line items       â”‚                    â”‚                                            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚                                            â”‚
â”‚             â”‚                               â”‚                                            â”‚
â”‚             â–¼                               â”‚                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚                                            â”‚
â”‚  â”‚  2. ORDER CONFIRMED â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚   TRIGGER:         â”‚   â”‚  3. PICK LIST       â”‚                  â”‚
â”‚  â”‚  Status: confirmed  â”‚   Auto or Manual   â”‚   â”‚     CREATED          â”‚                  â”‚
â”‚  â”‚  Payment processed  â”‚                    â”‚   â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚   â”‚  wms_pick_lists     â”‚                  â”‚
â”‚                                             â”‚   â”‚  wms_pick_list_itemsâ”‚                  â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â”‚â•â•â•â”‚â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â”‚â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â”‚
â”‚  HOW PICKING IS TRIGGERED:                  â”‚   â”‚  Stock reserved     â”‚                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                             â”‚              â”‚                              â”‚
â”‚  Option A: MANUAL                           â”‚              â”‚                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚              â”‚                              â”‚
â”‚  â”‚ Admin goes to /wms/pick    â”‚            â”‚              â”‚                              â”‚
â”‚  â”‚ â†’ Click "Create Pick List" â”‚            â”‚              â–¼                              â”‚
â”‚  â”‚ â†’ Select Order             â”‚            â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚ â†’ Pick list generated      â”‚            â”‚   â”‚  4. PICKING         â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚   â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚                  â”‚
â”‚                                             â”‚   â”‚  â€¢ Staff assigned   â”‚                  â”‚
â”‚  Option B: AUTO (FUTURE)                    â”‚   â”‚  â€¢ Scan case codes  â”‚                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚   â”‚  â€¢ Confirm picks    â”‚                  â”‚
â”‚  â”‚ Trigger.dev job on order   â”‚            â”‚   â”‚  â†’ SHIPPING loc     â”‚                  â”‚
â”‚  â”‚ status = 'confirmed'       â”‚            â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚  â”‚ â†’ Auto-create pick list    â”‚            â”‚              â”‚                              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚              â”‚                              â”‚
â”‚                                             â”‚              â–¼                              â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â”‚â•â•â•â”‚â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â”‚â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â”‚
â”‚                                             â”‚   â”‚                      â”‚                  â”‚
â”‚                                             â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚                                             â”‚   â”‚  5. DISPATCH BATCH  â”‚                  â”‚
â”‚                                             â”‚   â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚                  â”‚
â”‚                                             â”‚   â”‚  â€¢ Group by distrib â”‚                  â”‚
â”‚                                             â”‚   â”‚  â€¢ Generate DN      â”‚                  â”‚
â”‚                                             â”‚   â”‚  â€¢ Print pallet lbl â”‚                  â”‚
â”‚                                             â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                             â”‚              â”‚                              â”‚
â”‚                                             â”‚              â–¼                              â”‚
â”‚                                             â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚                                             â”‚   â”‚  6. DISPATCHED      â”‚                  â”‚
â”‚                                             â”‚   â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚                  â”‚
â”‚                                             â”‚   â”‚  Stock decremented  â”‚                  â”‚
â”‚  â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚  Order updated      â”‚                  â”‚
â”‚  Order status = 'dispatched'                â”‚   â”‚  Movement logged    â”‚                  â”‚
â”‚                                             â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                             â”‚                                            â”‚
â”‚  DOCUMENTS OUTPUT:                          â”‚   DOCUMENTS OUTPUT:                        â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                          â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                        â”‚
â”‚  ğŸ“„ Invoice (Zoho - future)                 â”‚   ğŸ“‹ Pick List                             â”‚
â”‚  ğŸ“„ Order Confirmation                      â”‚   ğŸ“„ Delivery Note (PDF)                   â”‚
â”‚                                             â”‚   ğŸ·ï¸ Pallet Label                          â”‚
â”‚                                             â”‚                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  </div>

  <h3>Data Flow: Receiving Creates Stock</h3>
  <p>Detailed view of what happens when a shipment is received:</p>

  <div style="background: #1e293b; color: #e2e8f0; padding: 1.5rem; border-radius: 8px; font-family: monospace; font-size: 0.8rem; line-height: 1.5; overflow-x: auto; white-space: pre;">
adminReceiveShipment.mutate({ shipmentId, items })
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. VALIDATE SHIPMENT                                                      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                      â”‚
â”‚  â€¢ Load shipment from logistics_shipments                                  â”‚
â”‚  â€¢ Verify partner exists (for ownership)                                   â”‚
â”‚  â€¢ Check status allows receiving                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. GENERATE LOT NUMBER                                                    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                      â”‚
â”‚  Format: YYYY-MM-DD-NNN (e.g., 2026-02-01-001)                            â”‚
â”‚  Used to group all items received together                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. FOR EACH ITEM                                                          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                          â”‚
â”‚                                                                            â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚    â”‚  a. Generate LWIN-18                                             â”‚    â”‚
â”‚    â”‚     {LWIN7}-{vintage}-{bottles}-{sizeMl}                         â”‚    â”‚
â”‚    â”‚     Example: 1010279-2015-06-00750                               â”‚    â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                         â”‚                                                  â”‚
â”‚                         â–¼                                                  â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚    â”‚  b. Check for existing stock (IDEMPOTENCY)                       â”‚    â”‚
â”‚    â”‚     SELECT * FROM wms_stock WHERE                                â”‚    â”‚
â”‚    â”‚       lwin18 = ? AND location_id = ? AND shipment_id = ?         â”‚    â”‚
â”‚    â”‚     If exists â†’ Skip (prevents duplicates on retry)              â”‚    â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                         â”‚                                                  â”‚
â”‚                         â–¼                                                  â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚    â”‚  c. INSERT wms_stock                                             â”‚    â”‚
â”‚    â”‚     â€¢ location_id (from item.locationId)                         â”‚    â”‚
â”‚    â”‚     â€¢ owner_id (from shipment.partner_id)                        â”‚    â”‚
â”‚    â”‚     â€¢ lwin18, product_name, quantity_cases                       â”‚    â”‚
â”‚    â”‚     â€¢ shipment_id (for provenance)                               â”‚    â”‚
â”‚    â”‚     â€¢ lot_number                                                 â”‚    â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                         â”‚                                                  â”‚
â”‚                         â–¼                                                  â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚    â”‚  d. INSERT wms_case_labels (for each case)                       â”‚    â”‚
â”‚    â”‚     â€¢ barcode: CASE-{LWIN18}-{seq}                               â”‚    â”‚
â”‚    â”‚     â€¢ lwin18, product_name, lot_number                           â”‚    â”‚
â”‚    â”‚     â€¢ current_location_id                                        â”‚    â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                         â”‚                                                  â”‚
â”‚                         â–¼                                                  â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚    â”‚  e. INSERT wms_stock_movements                                   â”‚    â”‚
â”‚    â”‚     â€¢ movement_type: 'receive'                                   â”‚    â”‚
â”‚    â”‚     â€¢ to_location_id: assigned location                          â”‚    â”‚
â”‚    â”‚     â€¢ quantity_cases, lwin18, product_name                       â”‚    â”‚
â”‚    â”‚     â€¢ shipment_id, lot_number                                    â”‚    â”‚
â”‚    â”‚     â€¢ performed_by: current user                                 â”‚    â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. UPDATE SHIPMENT STATUS                                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                  â”‚
â”‚  UPDATE logistics_shipments SET status = 'delivered' WHERE id = ?          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5. RETURN RESULT                                                          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                          â”‚
â”‚  { success: true, stockRecords: [...], caseLabels: [...] }                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  </div>

  <h3>Movement Types & When They're Created</h3>
  <table>
    <tr><th>Movement Type</th><th>Trigger</th><th>Location Fields</th><th>Stock Impact</th></tr>
    <tr>
      <td><code>receive</code></td>
      <td>Complete receiving</td>
      <td>to_location_id = assigned bay</td>
      <td>+ quantity</td>
    </tr>
    <tr>
      <td><code>transfer</code></td>
      <td>Transfer workflow</td>
      <td>from_location_id â†’ to_location_id</td>
      <td>Move between locations</td>
    </tr>
    <tr>
      <td><code>putaway</code></td>
      <td>Put-away workflow</td>
      <td>from: RECEIVING â†’ to: assigned bay</td>
      <td>Move from receiving</td>
    </tr>
    <tr>
      <td><code>pick</code></td>
      <td>Complete pick item</td>
      <td>from_location_id = picked bay</td>
      <td>- quantity</td>
    </tr>
    <tr>
      <td><code>adjust</code></td>
      <td>Manual adjustment</td>
      <td>location_id of adjustment</td>
      <td>+/- quantity (with reason)</td>
    </tr>
    <tr>
      <td><code>repack_out</code></td>
      <td>Repack source consumed</td>
      <td>location_id of repack</td>
      <td>- source quantity</td>
    </tr>
    <tr>
      <td><code>repack_in</code></td>
      <td>Repack target created</td>
      <td>location_id of repack</td>
      <td>+ target quantity</td>
    </tr>
    <tr>
      <td><code>ownership_transfer</code></td>
      <td>Transfer ownership</td>
      <td>N/A (same location)</td>
      <td>Owner changed</td>
    </tr>
  </table>

  <h3>Document Outputs Summary</h3>
  <table>
    <tr><th>Stage</th><th>Document</th><th>Format</th><th>Purpose</th></tr>
    <tr>
      <td rowspan="2">Receiving</td>
      <td>Case Labels</td>
      <td>ZPL â†’ Thermal Label</td>
      <td>Individual case identification</td>
    </tr>
    <tr>
      <td>Receiving Photos</td>
      <td>Image upload</td>
      <td>Condition documentation</td>
    </tr>
    <tr>
      <td>Locations</td>
      <td>Location Labels</td>
      <td>ZPL â†’ Thermal Label</td>
      <td>Bay identification for scanning</td>
    </tr>
    <tr>
      <td rowspan="2">Picking</td>
      <td>Pick List</td>
      <td>Screen / Print</td>
      <td>Staff picking instructions</td>
    </tr>
    <tr>
      <td>Pick Report</td>
      <td>PDF (future)</td>
      <td>Picking confirmation</td>
    </tr>
    <tr>
      <td rowspan="2">Dispatch</td>
      <td>Delivery Note</td>
      <td>PDF</td>
      <td>Driver/customer handover</td>
    </tr>
    <tr>
      <td>Pallet Label</td>
      <td>ZPL â†’ Thermal Label</td>
      <td>Pallet identification</td>
    </tr>
  </table>

  <h3>Current vs Future Integration</h3>

  <div class="status-box status-success">
    <strong>Currently Working (Test Ready):</strong>
    <ul style="margin-top: 0.5rem; margin-bottom: 0;">
      <li>Logistics shipments flow to WMS receiving</li>
      <li>Receiving creates stock at assigned locations</li>
      <li>Stock appears in all dashboard views</li>
      <li>Movement history tracks all actions</li>
      <li>Reconciliation can detect and fix discrepancies</li>
      <li>Case label ZPL generation</li>
    </ul>
  </div>

  <div class="status-box status-warning">
    <strong>Built But Needs Testing:</strong>
    <ul style="margin-top: 0.5rem; margin-bottom: 0;">
      <li>Put-away workflow with barcode scanning</li>
      <li>Transfer workflow</li>
      <li>Repack workflow</li>
      <li>Pick list creation and picking</li>
      <li>Dispatch batch creation</li>
      <li>Zebra Browser Print integration (hardware)</li>
    </ul>
  </div>

  <div class="status-box status-info">
    <strong>Future (Not Yet Built):</strong>
    <ul style="margin-top: 0.5rem; margin-bottom: 0;">
      <li>Auto-generate pick list when order confirmed (Trigger.dev job)</li>
      <li>Zoho invoice creation on order</li>
      <li>Zoho payment sync</li>
      <li>Delivery note PDF generation</li>
      <li>Partner portal stock view</li>
    </ul>
  </div>

  <h2 id="navigation">Navigation Guide</h2>

  <p>All WMS pages are under <code>/platform/admin/wms/</code></p>

  <h4>Main Pages</h4>
  <table>
    <tr><th>Page</th><th>Path</th><th>Purpose</th></tr>
    <tr><td>Dashboard</td><td class="nav-path">/wms</td><td>Overview, KPIs, quick actions</td></tr>
    <tr><td>Locations</td><td class="nav-path">/wms/locations</td><td>Manage warehouse bays</td></tr>
    <tr><td>Receive</td><td class="nav-path">/wms/receive</td><td>Receive incoming shipments</td></tr>
    <tr><td>Stock Overview</td><td class="nav-path">/wms/stock</td><td>View stock by product/owner</td></tr>
    <tr><td>All Stock</td><td class="nav-path">/wms/stock/all</td><td>Raw list of all stock records</td></tr>
    <tr><td>Reconcile</td><td class="nav-path">/wms/stock/reconcile</td><td>Fix discrepancies</td></tr>
    <tr><td>Movements</td><td class="nav-path">/wms/movements</td><td>Audit trail history</td></tr>
    <tr><td>Put-Away</td><td class="nav-path">/wms/putaway</td><td>Move stock to bins</td></tr>
    <tr><td>Transfer</td><td class="nav-path">/wms/transfer</td><td>Move between locations</td></tr>
    <tr><td>Repack</td><td class="nav-path">/wms/repack</td><td>Convert pack sizes</td></tr>
    <tr><td>Pick Lists</td><td class="nav-path">/wms/pick</td><td>Order fulfillment</td></tr>
    <tr><td>Dispatch</td><td class="nav-path">/wms/dispatch</td><td>Batch orders for delivery</td></tr>
    <tr><td>Labels</td><td class="nav-path">/wms/labels</td><td>Print case/location labels</td></tr>
    <tr><td>Scanner Test</td><td class="nav-path">/wms/scanner-test</td><td>Test barcode scanning</td></tr>
  </table>

  <h2 id="features">Feature Status</h2>

  <p>53 API controllers have been built across these functional areas:</p>

  <div class="feature-grid">
    <div class="feature-card">
      <h4>Locations <span class="badge badge-success">Built</span></h4>
      <p>Create, edit, batch create, print labels, barcode lookup</p>
      <p><strong>6 controllers</strong></p>
    </div>
    <div class="feature-card">
      <h4>Receiving <span class="badge badge-success">Built</span></h4>
      <p>Product-by-product flow, drafts, photo capture, pack variants, Zebra print</p>
      <p><strong>7 controllers</strong></p>
    </div>
    <div class="feature-card">
      <h4>Stock Views <span class="badge badge-success">Built</span></h4>
      <p>By product, by owner, by location, search, expiring alerts</p>
      <p><strong>8 controllers</strong></p>
    </div>
    <div class="feature-card">
      <h4>Reconciliation <span class="badge badge-success">Built</span></h4>
      <p>Compare movements vs stock, auto-fix, rebuild, dedupe</p>
      <p><strong>5 controllers</strong></p>
    </div>
    <div class="feature-card">
      <h4>Operations <span class="badge badge-success">Built</span></h4>
      <p>Put-away, transfer, repack, barcode lookup</p>
      <p><strong>5 controllers</strong></p>
    </div>
    <div class="feature-card">
      <h4>Labels <span class="badge badge-success">Built</span></h4>
      <p>Case labels, location labels, ZPL generation, print tracking</p>
      <p><strong>4 controllers</strong></p>
    </div>
    <div class="feature-card">
      <h4>Picking <span class="badge badge-success">Built</span></h4>
      <p>Create pick lists, assign, pick items, complete</p>
      <p><strong>6 controllers</strong></p>
    </div>
    <div class="feature-card">
      <h4>Dispatch <span class="badge badge-success">Built</span></h4>
      <p>Create batches, add orders, update status</p>
      <p><strong>5 controllers</strong></p>
    </div>
    <div class="feature-card">
      <h4>Ownership <span class="badge badge-success">Built</span></h4>
      <p>Transfer ownership, reserve, release, partner requests</p>
      <p><strong>5 controllers</strong></p>
    </div>
    <div class="feature-card">
      <h4>Partner Portal <span class="badge badge-info">Partial</span></h4>
      <p>Partner stock view (API ready, UI basic)</p>
      <p><strong>1 controller</strong></p>
    </div>
  </div>

  <h3>What's NOT Built Yet</h3>
  <ul>
    <li><strong>Cycle Counting</strong> - Schema exists, no UI</li>
    <li><strong>Customer Storage Pallets</strong> - Schema exists, no UI</li>
    <li><strong>Storage Billing</strong> - Schema exists, no UI</li>
    <li><strong>Zoho Integration</strong> - Not started</li>
  </ul>

  <h2 id="receiving">Receiving Workflow</h2>

  <div class="status-box status-info">
    <strong>Key Features:</strong> Product-by-product flow, photo capture, pack variant handling, save/resume drafts, Zebra label printing, per-product location assignment
  </div>

  <h3>Step-by-Step Process</h3>

  <div class="workflow-step">
    <div class="step-number">1</div>
    <div>
      <strong>Select Shipment</strong><br>
      Go to <span class="nav-path">WMS â†’ Receive</span>. Choose a pending shipment from the list.<br>
      <em>Note: Shipment must have a Partner assigned for stock ownership.</em>
    </div>
  </div>

  <div class="workflow-step">
    <div class="step-number">2</div>
    <div>
      <strong>Choose View Mode</strong><br>
      <ul>
        <li><strong>List View:</strong> See all items at once, quick quantity entry</li>
        <li><strong>Detail View:</strong> Product-by-product with full controls</li>
      </ul>
    </div>
  </div>

  <div class="workflow-step">
    <div class="step-number">3</div>
    <div>
      <strong>For Each Product (Detail View)</strong><br>
      <ol>
        <li><strong>Verify quantity:</strong> Enter actual received cases</li>
        <li><strong>Check pack config:</strong> If different from expected (e.g., 6x750ml vs 12x750ml), system handles it</li>
        <li><strong>Assign location:</strong> Scan bay barcode or select from dropdown</li>
        <li><strong>Print labels:</strong> Click "Print Labels" to send to Zebra printer</li>
        <li><strong>Take photo:</strong> Optional - capture receiving photo</li>
      </ol>
    </div>
  </div>

  <div class="workflow-step">
    <div class="step-number">4</div>
    <div>
      <strong>Save Draft (Optional)</strong><br>
      Click "Save Draft" to pause and resume later. Draft includes all quantities, locations, and notes.
    </div>
  </div>

  <div class="workflow-step">
    <div class="step-number">5</div>
    <div>
      <strong>Complete Receiving</strong><br>
      Click "Complete Receiving". System creates:
      <ul>
        <li>Stock records at assigned locations</li>
        <li>Case label records for each case</li>
        <li>Movement records (type: 'receive')</li>
        <li>Updates shipment status to 'delivered'</li>
      </ul>
    </div>
  </div>

  <h3>Pack Variant Handling</h3>
  <p>When received pack differs from expected:</p>
  <ul>
    <li>System generates correct LWIN-18 based on <em>actual</em> received pack</li>
    <li>Original item marked with variance note</li>
    <li>Can add additional pack variants (e.g., magnums received alongside standard bottles)</li>
  </ul>

  <h2 id="stock">Stock Management</h2>

  <h3>Stock Views</h3>
  <table>
    <tr><th>View</th><th>Path</th><th>Shows</th></tr>
    <tr><td>By Product</td><td class="nav-path">/wms/stock</td><td>Stock grouped by LWIN-18, expandable to see locations</td></tr>
    <tr><td>By Owner</td><td class="nav-path">/wms/stock?tab=owner</td><td>Stock grouped by partner/owner</td></tr>
    <tr><td>All Records</td><td class="nav-path">/wms/stock/all</td><td>Raw list of every stock record</td></tr>
    <tr><td>At Location</td><td class="nav-path">/wms/locations/[id]</td><td>All stock at a specific bay</td></tr>
  </table>

  <h3>Stock Reconciliation</h3>
  <p class="nav-path">/wms/stock/reconcile</p>

  <p>Reconciliation compares:</p>
  <ul>
    <li><strong>Expected Stock</strong> = Received - Picked + Adjustments (from movements)</li>
    <li><strong>Actual Stock</strong> = Sum of all stock records</li>
  </ul>

  <div class="status-box status-success">
    <strong>If Reconciled:</strong> Numbers match - everything is correct.
  </div>

  <div class="status-box status-warning">
    <strong>If Stock OVER (actual > expected):</strong><br>
    Duplicate or orphan records exist. Click <strong>"Auto-Fix"</strong> to remove them.
  </div>

  <div class="status-box status-warning">
    <strong>If Stock UNDER (actual < expected):</strong><br>
    Stock records missing. Click <strong>"Rebuild Stock"</strong> to recreate from movements.
  </div>

  <h3>Data Integrity</h3>
  <p>The system prevents duplicates with:</p>
  <ul>
    <li><strong>Database constraint:</strong> Unique index on (lwin18, location_id, shipment_id)</li>
    <li><strong>Code check:</strong> Receiving checks for existing stock before creating</li>
    <li><strong>Cleanup tools:</strong> Deduplicate and Auto-Fix buttons</li>
  </ul>

  <h2 id="operations">Warehouse Operations</h2>

  <h3>Put-Away</h3>
  <p class="nav-path">/wms/putaway</p>
  <ol>
    <li>Scan case barcode (shows product details)</li>
    <li>Scan destination location barcode</li>
    <li>Confirm move</li>
  </ol>

  <h3>Transfer</h3>
  <p class="nav-path">/wms/transfer</p>
  <ol>
    <li>Scan source (case or location)</li>
    <li>If location: select items and quantities to move</li>
    <li>Scan destination location</li>
    <li>Confirm transfer</li>
  </ol>

  <h3>Repack</h3>
  <p class="nav-path">/wms/repack</p>
  <p>Convert pack sizes (e.g., 1x 12-pack â†’ 2x 6-packs):</p>
  <ol>
    <li>Scan source case</li>
    <li>Select target pack configuration</li>
    <li>Confirm - creates new stock records with correct LWIN-18</li>
  </ol>

  <h2 id="picking">Picking & Dispatch</h2>

  <h3>Pick Lists</h3>
  <p class="nav-path">/wms/pick</p>
  <ol>
    <li>Create pick list from an order</li>
    <li>Assign to warehouse staff</li>
    <li>Pick each item (scan case barcodes)</li>
    <li>Complete when all items picked</li>
  </ol>

  <h3>Dispatch Batching</h3>
  <p class="nav-path">/wms/dispatch</p>
  <ol>
    <li>Create batch for a distributor</li>
    <li>Add orders to the batch</li>
    <li>Generate pick list for the batch</li>
    <li>Pick items â†’ staged in SHIPPING location</li>
    <li>Generate delivery note(s)</li>
    <li>Mark batch as dispatched</li>
  </ol>

  <h2 id="testing">Testing Checklist</h2>

  <div class="status-box status-info">
    <strong>Interactive Test Schedule Available:</strong><br>
    Use the <a href="/docs/wms-test-schedule.html" style="color: var(--primary); font-weight: bold;">WMS Test Schedule</a> for a comprehensive step-by-step testing session with progress tracking.
  </div>

  <h3>Core Workflows</h3>
  <ul class="checklist">
    <li>Create a new location (e.g., TEST-01-00)</li>
    <li>Print location label and verify it scans</li>
    <li>Receive a shipment with 2+ products</li>
    <li>Verify stock appears at correct locations after receiving</li>
    <li>Check dashboard shows correct totals</li>
    <li>Check Stock by Owner shows partner breakdown</li>
    <li>Run reconciliation - should show "Stock is Reconciled"</li>
    <li>Transfer stock from one location to another</li>
    <li>Verify movement history shows all actions</li>
  </ul>

  <h3>Receiving Details</h3>
  <ul class="checklist">
    <li>Save a receiving draft and resume it later</li>
    <li>Receive with pack variant (different bottles per case)</li>
    <li>Add extra product during receiving</li>
    <li>Upload photo during receiving</li>
    <li>Print case labels during receiving</li>
    <li>Verify case label barcodes scan correctly</li>
  </ul>

  <h3>Hardware (TC27 + ZD421)</h3>
  <ul class="checklist">
    <li>Scanner Test page detects barcode scans</li>
    <li>Scan location barcode â†’ shows in UI</li>
    <li>Scan case barcode â†’ shows product details</li>
    <li>Print case label â†’ ZD421 prints correctly</li>
    <li>Printed label barcode scans back correctly</li>
    <li>Put-away workflow works with scanner</li>
    <li>Transfer workflow works with scanner</li>
  </ul>

  <h3>Edge Cases</h3>
  <ul class="checklist">
    <li>Receiving retry doesn't create duplicates</li>
    <li>Partial transfer (move 2 of 5 cases)</li>
    <li>Repack 12-pack to 6-packs</li>
    <li>Stock search finds products by partial name</li>
    <li>Expiring stock alert appears for perishable items</li>
  </ul>

  <h2 id="hardware">Hardware Setup</h2>

  <h3>Zebra TC27 Mobile Computer</h3>
  <ol>
    <li>Install Chrome browser from Play Store</li>
    <li>Install <strong>Zebra Browser Print</strong> app from Play Store</li>
    <li>Go to Settings â†’ Scanner â†’ configure for <strong>Keyboard Wedge</strong> mode</li>
    <li>Navigate to <code>cc.craftandculture.ae</code> and log in</li>
    <li>Test on <span class="nav-path">/wms/scanner-test</span> page</li>
  </ol>

  <h3>Zebra ZD421 Label Printer</h3>
  <ol>
    <li>Pair with TC27 via Bluetooth</li>
    <li>Load 4" x 2" direct thermal labels (no ribbon)</li>
    <li>Run auto-calibration for label size</li>
    <li>Open Zebra Browser Print app on TC27</li>
    <li>Connect to the ZD421 printer in the app</li>
    <li>Test print from <span class="nav-path">/wms/labels</span> page</li>
  </ol>

  <h3>Barcode Formats</h3>
  <table>
    <tr><th>Type</th><th>Format</th><th>Example</th></tr>
    <tr><td>Case Label</td><td><code>CASE-{LWIN18}-{seq}</code></td><td>CASE-1010279-2015-06-00750-001</td></tr>
    <tr><td>Location Label</td><td><code>LOC-{code}</code></td><td>LOC-A-01-02</td></tr>
  </table>

  <h3>Barcode Structure Breakdown</h3>

  <h4>Case Barcode</h4>
  <div style="background: #1e293b; color: #e2e8f0; padding: 1rem; border-radius: 8px; font-family: monospace; font-size: 0.85rem; line-height: 1.6; overflow-x: auto; white-space: pre;">
CASE-1010279-2015-06-00750-001
â”‚    â”‚       â”‚    â”‚  â”‚     â”‚
â”‚    â”‚       â”‚    â”‚  â”‚     â””â”€â”€ Sequence (3 digits, zero-padded)
â”‚    â”‚       â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€ Bottle size in ml (00750 = 750ml)
â”‚    â”‚       â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Pack config (06 = 6-pack)
â”‚    â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Vintage year (2015)
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ LWIN7 (wine identifier from Liv-ex)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Prefix (identifies as case label)
  </div>

  <h4>Location Barcode</h4>
  <div style="background: #1e293b; color: #e2e8f0; padding: 1rem; border-radius: 8px; font-family: monospace; font-size: 0.85rem; line-height: 1.6; overflow-x: auto; white-space: pre;">
LOC-A-01-02
â”‚   â”‚ â”‚  â”‚
â”‚   â”‚ â”‚  â””â”€â”€ Level (00 = floor, 01-03 = upper shelves)
â”‚   â”‚ â””â”€â”€â”€â”€â”€ Bay number (01, 02, etc.)
â”‚   â””â”€â”€â”€â”€â”€â”€â”€ Aisle letter (A, B, C, etc.)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Prefix (identifies as location label)
  </div>

  <h3>How Barcodes Work</h3>

  <p>The text barcode (e.g., <code>CASE-1010279-2015-06-00750-001</code>) is <strong>encoded as a Code 128 barcode</strong> - a pattern of bars and spaces that the scanner reads.</p>

  <div style="background: #1e293b; color: #e2e8f0; padding: 1.5rem; border-radius: 8px; font-family: monospace; font-size: 0.85rem; line-height: 1.6; overflow-x: auto; white-space: pre;">
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                â”‚
â”‚  â•‘â•‘â–ˆâ•‘â•‘â–ˆâ•‘â–ˆâ–ˆâ•‘â–ˆâ•‘â•‘â–ˆâ–ˆâ•‘â•‘â–ˆâ•‘â•‘â–ˆâ•‘â–ˆâ•‘â–ˆâ–ˆâ•‘â•‘â–ˆâ•‘â–ˆâ•‘â•‘â–ˆâ–ˆâ•‘â•‘â–ˆâ•‘â–ˆâ•‘     â”‚  â† Code 128 barcode
â”‚  CASE-1010279-2015-06-00750-001                â”‚  â† Human-readable text
â”‚                                                â”‚
â”‚  ChÃ¢teau Margaux 2015                          â”‚  â† Product name
â”‚                                                â”‚
â”‚  LWIN: 1010279-2015-06-00750       6x75cl      â”‚
â”‚  Lot: 2026-01-31-001               Bay: A-01-02â”‚
â”‚                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             4" x 2" thermal label
  </div>

  <h4>The Process</h4>
  <ol>
    <li><strong>ZPL Command</strong> - System generates ZPL code with <code>^BC</code> (Code 128) command</li>
    <li><strong>Encoding</strong> - Zebra printer encodes the text into bar/space patterns</li>
    <li><strong>Printing</strong> - ZD421 prints the barcode on thermal label</li>
    <li><strong>Scanning</strong> - TC27 reads the pattern and decodes back to text</li>
    <li><strong>Input</strong> - Text appears in the browser as keyboard input (wedge mode)</li>
  </ol>

  <h3>Uniqueness Enforcement</h3>

  <p>Each barcode must be globally unique. The system ensures this through:</p>

  <table>
    <tr><th>Layer</th><th>Mechanism</th><th>Purpose</th></tr>
    <tr>
      <td>Database</td>
      <td>Unique constraint on <code>wms_case_labels.barcode</code></td>
      <td>Hard block on duplicates</td>
    </tr>
    <tr>
      <td>Transaction</td>
      <td>PostgreSQL advisory locks</td>
      <td>Prevent race conditions</td>
    </tr>
    <tr>
      <td>Sequence</td>
      <td>Global max sequence per LWIN18</td>
      <td>Never reuse sequence numbers</td>
    </tr>
    <tr>
      <td>Validation</td>
      <td>Dual check (SQL + JavaScript)</td>
      <td>Safety backup for sequence calculation</td>
    </tr>
  </table>

  <div class="status-box status-info">
    <strong>Why Globally Unique?</strong><br>
    The barcode includes the LWIN18, so the same wine from different shipments would collide if we only tracked sequence per shipment. The system tracks the max sequence across ALL labels with the same LWIN18 prefix.
  </div>

  <h3>Label Content</h3>
  <table>
    <tr><th>Label Type</th><th>Size</th><th>Contains</th></tr>
    <tr><td>Case Label</td><td>4" x 2"</td><td>Barcode, Product Name, LWIN, Pack Size, Location, Lot</td></tr>
    <tr><td>Location Label</td><td>4" x 2"</td><td>Barcode, Location Code (large), Aisle/Bay/Level</td></tr>
  </table>

  <h2 id="troubleshooting">Troubleshooting</h2>

  <h3>Dashboard shows all zeros</h3>
  <div class="status-box status-warning">
    <strong>Cause:</strong> Stock records missing or deleted<br>
    <strong>Fix:</strong> Go to <span class="nav-path">/wms/stock/reconcile</span> â†’ Click "Rebuild Stock"
  </div>

  <h3>Reconciliation shows discrepancy</h3>
  <div class="status-box status-warning">
    <strong>If actual > expected:</strong> Click "Auto-Fix" to remove orphan/duplicate records<br>
    <strong>If actual < expected:</strong> Click "Rebuild Stock" to recreate from movements
  </div>

  <h3>Labels not printing</h3>
  <div class="status-box status-warning">
    <strong>Check:</strong>
    <ul>
      <li>Zebra Browser Print app is open on TC27</li>
      <li>Printer is connected in the app (shows as available)</li>
      <li>Printer has labels and is powered on</li>
      <li>Try a test print from within Zebra Browser Print app first</li>
    </ul>
  </div>

  <h3>Scanner not detecting barcodes</h3>
  <div class="status-box status-warning">
    <strong>Check:</strong>
    <ul>
      <li>Scanner is in Keyboard Wedge mode (check device settings)</li>
      <li>Cursor is focused in a text input field</li>
      <li>Test on <span class="nav-path">/wms/scanner-test</span> page</li>
      <li>Barcode is clean and undamaged</li>
    </ul>
  </div>

  <h3>Receiving fails with "Partner required"</h3>
  <div class="status-box status-warning">
    <strong>Cause:</strong> Shipment doesn't have an associated partner<br>
    <strong>Fix:</strong> Edit the shipment in Logistics and assign a partner before receiving
  </div>

  <h3>Duplicate stock created</h3>
  <div class="status-box status-warning">
    <strong>This should not happen</strong> with current safeguards. If it does:<br>
    <ol>
      <li>Go to <span class="nav-path">/wms/stock/reconcile</span></li>
      <li>Click "Auto-Fix" to merge duplicates</li>
      <li>Report the issue so we can investigate</li>
    </ol>
  </div>

  <h3>"Clean Up Duplicate Stock" button on dashboard</h3>
  <div class="status-box status-info">
    This is a legacy cleanup tool. Use the Reconciliation page instead - it has more comprehensive Auto-Fix and Rebuild options.
  </div>

  <hr style="margin: 3rem 0; border: none; border-top: 1px solid var(--border);">

  <p style="color: var(--text-muted); font-size: 0.9rem;">
    <strong>WMS Version:</strong> 53 controllers, 23 UI pages, 14 database tables<br>
    <strong>Last updated:</strong> February 2026<br>
    <strong>Technical reference:</strong> <code>apps/web/src/app/_wms/WMS.md</code>
  </p>
</body>
</html>
